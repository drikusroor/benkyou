<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Prompt&display=swap" rel="stylesheet">
    <title>Learn Japanese</title>
    <style>
        body {
            font-family: 'Prompt', 'Arial', sans-serif;
            text-align: center;
        }
    </style>
</head>

<body>
    <div class="min-h-screen bg-black flex flex-col items-center justify-center p-5">

        <div class="flex flex-row gap-4">
            <div class="rounded-xl bg-slate-900 p-4 mb-4">
                <a id="englishLink" href="?lang=en" class="text-white hover:text-pink-400">English</a>
                <span class="text-white">|</span>
                <a id="dutchLink" href="?lang=nl" class="text-white hover:text-pink-400">Nederlands</a>
            </div>

            <div class="rounded-xl bg-slate-900 p-4 mb-4">
                <a id="fromJapaneseLink" href="?mode=fromJapanese" class="text-white hover:text-pink-400">は > ha</a>
                <span class="text-white">|</span>
                <a id="toJapaneseLink" href="?mode=toJapanese" class="text-white hover:text-pink-400">ha > は</a>
            </div>
        </div>
            
        <div class="bg-opacity-60 shadow-lg rounded-xl p-8 w-full max-w-xl border border-purple-600 bg-slate-900 transition-colors"
            id="questionBox">
            <h1 id="title" class="text-4xl font-bold mb-4 text-pink-400">Learn Japanese</h1>
            <h2 id="subTitle" class="text-2xl font-semibold mb-6 text-purple-500 tracking-wider">100 most important
                Japanese sentences
                and words</h2>

            <form id="answerForm" class="space-y-4">
                <div id="question" class="text-xl text-white font-medium"></div>

                <div>
                    <input type="text" id="answer" placeholder="Type your answer" required
                        class="w-full p-3 border border-purple-400 bg-opacity-50 bg-slate-800 text-white rounded-md focus:outline-none focus:border-pink-400 focus:ring focus:ring-purple-300 transition duration-150 ease-in-out">
                </div>

                <div>
                    <button type="submit" id="submitAnswerButton"
                        class="bg-purple-600 text-white px-6 py-3 rounded-md hover:bg-pink-600 focus:outline-none focus:border-pink-700 focus:ring focus:ring-purple-400 active:bg-pink-700 transition duration-150 ease-in-out">
                        Submit
                    </button>
                </div>

                <div id="feedback" class="text-lg text-pink-400 font-medium"></div>
            </form>
        </div>

        <div class="mt-8 bg-slate-900">

            <form class="flex items-center justify-center space-x-4 p-4">
                <input type="text" id="searchCheatsheet" placeholder="Search"
                    class="w-full p-3 border border-purple-400 bg-opacity-50 bg-slate-800 text-white rounded-md focus:outline-none focus:border-pink-400 focus:ring focus:ring-purple-300 transition duration-150 ease-in-out">
            </form>

            <ul class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 p-4" id="cheatsheet">
            </ul>
        </div>

    </div>

    <audio id="correctAudio" src="correct.m4a"></audio>
    <audio id="incorrectAudio" src="incorrect.m4a"></audio>

    <script>
        const currentLanguage = getCurrentLanguage();
        const learningMode = getMode();

        const translations = {
            nl: {
                title: "Leer Japans",
                mostImportantWords: "100 belangrijkste Japanse zinnen en woorden",
                answer: "Typ je antwoord",
                submitAnswerButton: "Verstuur",
                correct: "Correct!",
                incorrect: "Incorrect! Correcte antwoord(en): ",
                correctAnswers: "Correcte antwoorden: ",
                nextQuestion: "Volgende vraag",
                search: "Zoeken",
            }
        }

        const sentences = [
            {
                "q": "こんにちは (Konnichiwa)",
                "en": [
                    "Hello."
                ],
                "nl": [
                    "Hallo."
                ]
            },
            {
                "q": "こんばんは (Konbanwa)",
                "en": [
                    "Good evening."
                ],
                "nl": [
                    "Goedenavond."
                ]
            },
            {
                "q": "さようなら (Sayonara)",
                "en": [
                    "Goodbye."
                ],
                "nl": [
                    "Tot ziens.",
                    "Vaarwel."
                ]
            },
            {
                "q": "ありがとうございます (Arigatou gozaimasu)",
                "en": [
                    "Thank you.",
                    "Thank you very much.",
                    "Thanks."
                ],
                "nl": [
                    "Dank je.",
                    "Dank je wel.",
                    "Bedankt."
                ]
            },
            {
                "q": "はい (Hai)",
                "en": [
                    "Yes."
                ],
                "nl": [
                    "Ja."
                ]
            },
            {
                "q": "いいえ (Iie)",
                "en": [
                    "No."
                ],
                "nl": [
                    "Nee."
                ]
            },
            {
                "q": "すみません (Sumimasen)",
                "en": [
                    "Excuse me."
                ],
                "nl": [
                    "Pardon.",
                    "Sorry."
                ]
            },
            {
                "q": "おはようございます (Ohayou gozaimasu)",
                "en": [
                    "Good morning."
                ],
                "nl": [
                    "Goedemorgen."
                ]
            },
            {
                "q": "おやすみなさい (Oyasuminasai)",
                "en": [
                    "Goodnight."
                ],
                "nl": [
                    "Goedenacht."
                ]
            },
            {
                "q": "お名前は何ですか (Onamae wa nan desu ka?)",
                "en": [
                    "What's your name?"
                ],
                "nl": [
                    "Hoe heet je?",
                    "Wat is je naam?"
                ]
            },
            {
                "q": "わたしは [name] です (Watashi wa [name] desu)",
                "en": [
                    "I am [name]."
                ],
                "nl": [
                    "Ik ben [name].",
                    "Mijn naam is [name]."
                ]
            },
            {
                "q": "どこから来ましたか (Doko kara kimashita ka?)",
                "en": [
                    "Where are you from?"
                ],
                "nl": [
                    "Waar kom je vandaan?"
                ]
            },
            {
                "q": "わたしは [country] から来ました (Watashi wa [country] kara kimashita)",
                "en": [
                    "I'm from [country].",
                    "I came from [country]."
                ],
                "nl": [
                    "Ik kom uit [country].",
                ]
            },
            {
                "q": "日本語が分かりません (Nihongo ga wakarimasen)",
                "en": [
                    "I don't understand Japanese."
                ],
                "nl": [
                    "Ik spreek geen Japans.",
                    "Ik versta geen Japans."
                ]
            },
            {
                "q": "英語を話せますか (Eigo o hanasemasu ka?)",
                "en": [
                    "Can you speak English?",
                    "Do you speak English?"
                ],
                "nl": [
                    "Spreek je Engels?",
                    "Kun je Engels spreken?"
                ]
            },
            {
                "q": "トイレはどこですか (Toire wa doko desu ka?)",
                "en": [
                    "Where is the bathroom?",
                    "Where is the toilet?"
                ],
                "nl": [
                    "Waar is het toilet?",
                    "Waar is de wc?"
                ]
            },
            {
                "q": "水をください (Mizu o kudasai)",
                "en": [
                    "Please give me water.",
                    "Please give me some water.",
                    "Water, please."
                ],
                "nl": [
                    "Water, alstublieft."
                ]
            },
            {
                "q": "いくらですか (Ikura desu ka?)",
                "en": [
                    "How much is it?",
                    "How much does it cost?"
                ],
                "nl": [
                    "Hoeveel kost het?",
                    "Hoeveel is het?",
                    "Wat kost het?",
                    "Hoe duur is het?"
                ]
            },
            {
                "q": "高いです (Takai desu)",
                "en": [
                    "It's expensive."
                ],
                "nl": [
                    "Het is duur."
                ]
            },
            {
                "q": "安いです (Yasui desu)",
                "en": [
                    "It's cheap."
                ],
                "nl": [
                    "Het is goedkoop."
                ]
            },
            {
                "q": "美味しい (Oishii)",
                "en": [
                    "Delicious.",
                    "Tasty."
                ],
                "nl": [
                    "Lekker.",
                    "Smaakvol."
                ]
            },
            {
                "q": "お腹がすいた (Onaka ga suita)",
                "en": [
                    "I'm hungry."
                ],
                "nl": [
                    "Ik heb honger."
                ]
            },
            {
                "q": "のどが渇いた (Nodo ga kawaita)",
                "en": [
                    "I'm thirsty."
                ],
                "nl": [
                    "Ik heb dorst."
                ]
            },
            {
                "q": "駅はどこですか (Eki wa doko desu ka?)",
                "en": [
                    "Where is the station?"
                ],
                "nl": [
                    "Waar is het station?"
                ]
            },
            {
                "q": "これをください (Kore o kudasai)",
                "en": [
                    "I'll take this."
                ],
                "nl": [
                    "Ik neem deze."
                ]
            },
            {
                "q": "助けて (Tasukete)",
                "en": [
                    "Help!"
                ],
                "nl": [
                    "Help!"
                ]
            },
            {
                "q": "病院はどこですか (Byouin wa doko desu ka?)",
                "en": [
                    "Where is the hospital?"
                ],
                "nl": [
                    "Waar is het ziekenhuis?"
                ]
            },
            {
                "q": "痛い (Itai)",
                "en": [
                    "It hurts."
                ],
                "nl": [
                    "Het doet pijn."
                ]
            },
            {
                "q": "どれ (Dore?)",
                "en": [
                    "Which one?", "Which?"
                ],
                "nl": [
                    "Welke?"
                ]
            },
            {
                "q": "今何時ですか (Ima nanji desu ka?)",
                "en": [
                    "What time is it now?",
                    "What's the time?"
                ],
                "nl": [
                    "Hoe laat is het nu?"
                ]
            },
            {
                "q": "日本は初めてです (Nihon wa hajimete desu)",
                "en": [
                    "It's my first time in Japan."
                ],
                "nl": [
                    "Het is mijn eerste keer in Japan."
                ]
            },
            {
                "q": "また会いましょう (Mata aimashou)",
                "en": [
                    "Let's meet again."
                ],
                "nl": [
                    "Laten we elkaar weer ontmoeten.",
                    "Laten we weer afspreken."
                ]
            },
            {
                "q": "分かりました (Wakarimashita)",
                "en": [
                    "I understand."
                ],
                "nl": [
                    "Ik begrijp het."
                ]
            },
            {
                "q": "もう一度言ってください (Mou ichido itte kudasai)",
                "en": [
                    "Please say it one more time."
                ],
                "nl": [
                    "Zeg het nog een keer, alstublieft."
                ]
            },
            {
                "q": "インターネットがつながりません (Inta-netto ga tsunagari masen)",
                "en": [
                    "The internet isn't working."
                ],
                "nl": [
                    "Het internet werkt niet."
                ]
            },
            {
                "q": "メニューを見せてください (Menyu o misete kudasai)",
                "en": [
                    "Please show me the menu.",
                    "The menu, please."
                ],
                "nl": [
                    "Laat me de menukaart zien, alstublieft.",
                    "De menukaart, alstublieft."
                ]
            },
            {
                "q": "チェックをください (Chekku o kudasai)",
                "en": [
                    "Check, please.",
                ],
                "nl": [
                    "De rekening, alstublieft."
                ]
            },
            {
                "q": "電話番号は何ですか (Denwa bangou wa nan desu ka?)",
                "en": [
                    "What's your phone number?"
                ],
                "nl": [
                    "Wat is je telefoonnummer?"
                ]
            },
            {
                "q": "予約したい (Yoyaku shitai)",
                "en": [
                    "I'd like to make a reservation."
                ],
                "nl": [
                    "Ik wil graag een reservering maken."
                ]
            },
            {
                "q": "無料ですか (Muryou desu ka?)",
                "en": [
                    "Is it free?"
                ],
                "nl": [
                    "Is het gratis?"
                ]
            },
            {
                "q": "ホテルはどこですか (Hoteru wa doko desu ka?)",
                "en": [
                    "Where is the hotel?"
                ],
                "nl": [
                    "Waar is het hotel?"
                ]
            },
            {
                "q": "Wi-Fiのパスワードは何ですか (Wi-Fi no pasuwādo wa nan desu ka?)",
                "en": [
                    "What's the Wi-Fi password?"
                ],
                "nl": [
                    "Wat is het Wi-Fi wachtwoord?"
                ]
            },
            {
                "q": "すぐに (Sugu ni)",
                "en": [
                    "Right away."
                ],
                "nl": [
                    "Onmiddellijk.",
                    "Direct."
                ]
            },
            {
                "q": "ゆっくり (Yukkuri)",
                "en": [
                    "Slowly."
                ],
                "nl": [
                    "Langzaam."
                ]
            },
            {
                "q": "大丈夫 (Daijoubu)",
                "en": [
                    "It's okay."
                ],
                "nl": [
                    "Het is goed.",
                    "Het is oké."
                ]
            },
            {
                "q": "違います (Chigaimasu)",
                "en": [
                    "It's wrong."
                ],
                "nl": [
                    "Het is fout.",
                    "Het is verkeerd."
                ]
            },
            {
                "q": "わたしの (Watashi no)",
                "en": [
                    "Mine.",
                    "My."
                ],
                "nl": [
                    "Mijn."
                ]
            },
            {
                "q": "いつ (Itsu?)",
                "en": [
                    "When?"
                ],
                "nl": [
                    "Wanneer?"
                ]
            },
            {
                "q": "どうして (Doushite?)",
                "en": [
                    "Why?"
                ],
                "nl": [
                    "Waarom?"
                ]
            },
            {
                "q": "どこ (Doko?)",
                "en": [
                    "Where?"
                ],
                "nl": [
                    "Waar?"
                ]
            },
            {
                "q": "誰 (Dare?)",
                "en": [
                    "Who?"
                ],
                "nl": [
                    "Wie?"
                ]
            },
            {
                "q": "どう (Dou?)",
                "en": [
                    "How?"
                ],
                "nl": [
                    "Hoe?"
                ]
            },
            {
                "q": "何 (Nani?)",
                "en": [
                    "What?"
                ],
                "nl": [
                    "Wat?"
                ]
            },
            {
                "q": "好きです (Suki desu)",
                "en": [
                    "I like it."
                ],
                "nl": [
                    "Ik vind het leuk.",
                    "Ik vind het lekker."
                ]
            },
            {
                "q": "嫌いです (Kirai desu)",
                "en": [
                    "I don't like it."
                ],
                "nl": [
                    "Ik vind het niet leuk.",
                    "Ik vind het niet lekker."
                ]
            },
            {
                "q": "もっと (Motto)",
                "en": [
                    "More."
                ],
                "nl": [
                    "Meer."
                ]
            },
            {
                "q": "それで (Sore de)",
                "en": [
                    "And then?"
                ],
                "nl": [
                    "En toen?"
                ]
            },
            {
                "q": "こちら (Kochira)",
                "en": [
                    "This way."
                ],
                "nl": [
                    "Deze kant op."
                ]
            },
            {
                "q": "あそこ (Asoko)",
                "en": [
                    "Over there."
                ],
                "nl": [
                    "Daar.",
                ]
            },
            {
                "q": "今日 (Kyou)",
                "en": [
                    "Today."
                ],
                "nl": [
                    "Vandaag."
                ]
            },
            {
                "q": "明日 (Ashita)",
                "en": [
                    "Tomorrow."
                ],
                "nl": [
                    "Morgen."
                ]
            },
            {
                "q": "昨日 (Kinou)",
                "en": [
                    "Yesterday."
                ],
                "nl": [
                    "Gisteren."
                ]
            },
            {
                "q": "いつも (Itsumo)",
                "en": [
                    "Always."
                ],
                "nl": [
                    "Altijd."
                ]
            },
            {
                "q": "たまに (Tama ni)",
                "en": [
                    "Sometimes."
                ],
                "nl": [
                    "Soms."
                ]
            },
            {
                "q": "もう (Mou)",
                "en": [
                    "Already."
                ],
                "nl": [
                    "Al.",
                    "Alweer."
                ]
            },
            {
                "q": "まだ (Mada)",
                "en": [
                    "Not yet."
                ],
                "nl": [
                    "Nog niet."
                ]
            },
            {
                "q": "ここ (Koko)",
                "en": [
                    "Here."
                ],
                "nl": [
                    "Hier."
                ]
            },
            {
                "q": "どうぞ (Douzo)",
                "en": [
                    "Please (when offering something).",
                    "Please",
                    "Here you go."
                ],
                "nl": [
                    "Alstublieft (als je iets aanbiedt).",
                    "Alstublieft"
                ]
            },
            {
                "q": "よろしくお願いします (Yoroshiku onegaishimasu)",
                "en": [
                    "Nice to meet you",
                    "Please take care of it.",
                ],
                "nl": [
                    "Aangenaam kennis te maken.",
                    "Dank je wel.",
                    "Dank u wel.",
                    "Bedankt."
                ]
            },
            {
                "q": "遅い (Osoi)",
                "en": [
                    "Late."
                ],
                "nl": [
                    "Laat."
                ]
            },
            {
                "q": "早い (Hayai)",
                "en": [
                    "Early.",
                    "Fast."
                ],
                "nl": [
                    "Vroeg.",
                    "Snel."
                ]
            },
            {
                "q": "いい (Ii)",
                "en": [
                    "Good.",
                    "Fine.",
                    "Okay.",
                    "Nice."
                ],
                "nl": [
                    "Goed.",
                    "Prima.",
                    "Oké.",
                    "Mooi."
                ]
            },
            {
                "q": "悪い (Warui)",
                "en": [
                    "Bad."
                ],
                "nl": [
                    "Slecht."
                ]
            },
            {
                "q": "大きい (Ookii)",
                "en": [
                    "Big."
                ],
                "nl": [
                    "Groot."
                ]
            },
            {
                "q": "小さい (Chiisai)",
                "en": [
                    "Small."
                ],
                "nl": [
                    "Klein."
                ]
            },
            {
                "q": "長い (Nagai)",
                "en": [
                    "Long."
                ],
                "nl": [
                    "Lang."
                ]
            },
            {
                "q": "短い (Mijikai)",
                "en": [
                    "Short."
                ],
                "nl": [
                    "Kort."
                ]
            },
            {
                "q": "寒い (Samui)",
                "en": [
                    "Cold."
                ],
                "nl": [
                    "Koud."
                ]
            },
            {
                "q": "暑い (Atsui)",
                "en": [
                    "Hot."
                ],
                "nl": [
                    "Warm."
                ]
            },
            {
                "q": "眠い (Nemui)",
                "en": [
                    "Sleepy."
                ],
                "nl": [
                    "Slaperig."
                ]
            },
            {
                "q": "うるさい (Urusai)",
                "en": [
                    "Noisy."
                ],
                "nl": [
                    "Luidruchtig.",
                    "Lawaaierig."
                ]
            },
            {
                "q": "静か (Shizuka)",
                "en": [
                    "Quiet."
                ],
                "nl": [
                    "Stil."
                ]
            },
            {
                "q": "甘い (Amai)",
                "en": [
                    "Sweet."
                ],
                "nl": [
                    "Zoet."
                ]
            },
            {
                "q": "辛い (Karai)",
                "en": [
                    "Spicy."
                ],
                "nl": [
                    "Pittig."
                ]
            },
            {
                "q": "楽しい (Tanoshii)",
                "en": [
                    "Fun."
                ],
                "nl": [
                    "Leuk.",
                    "Plezierig."
                ]
            },
            {
                "q": "つまらない (Tsumaranai)",
                "en": [
                    "Boring."
                ],
                "nl": [
                    "Saai."
                ]
            },
            {
                "q": "新しい (Atarashii)",
                "en": [
                    "New."
                ],
                "nl": [
                    "Nieuw."
                ]
            },
            {
                "q": "古い (Furui)",
                "en": [
                    "Old."
                ],
                "nl": [
                    "Oud."
                ]
            },
            {
                "q": "近い (Chikai)",
                "en": [
                    "Near.", "Close."
                ],
                "nl": [
                    "Dichtbij."
                ]
            },
            {
                "q": "遠い (Tooi)",
                "en": [
                    "Far."
                ],
                "nl": [
                    "Ver."
                ]
            },
            {
                "q": "綺麗 (Kirei)",
                "en": [
                    "Beautiful."
                ],
                "nl": [
                    "Mooi."
                ]
            },
            {
                "q": "汚い (Kitanai)",
                "en": [
                    "Dirty."
                ],
                "nl": [
                    "Vies.",
                    "Vuil."
                ]
            },
            {
                "q": "明るい (Akarui)",
                "en": [
                    "Bright."
                ],
                "nl": [
                    "Helder.",
                    "Licht."
                ]
            },
            {
                "q": "暗い (Kurai)",
                "en": [
                    "Dark."
                ],
                "nl": [
                    "Donker.",
                    "Duister."
                ]
            },
            {
                "q": "高い (Takai)",
                "en": [
                    "Tall.",
                    "High.",
                ],
                "nl": [
                    "Hoog.",
                    "Lang."
                ]
            },
            {
                "q": "低い (Hikui)",
                "en": [
                    "Short (in height).",
                    "Short",
                    "Low."
                ],
                "nl": [
                    "Laag.",
                    "Klein."
                ]
            },
            {
                "q": "若い (Wakai)",
                "en": [
                    "Young.",
                ],
                "nl": [
                    "Jong."
                ]
            },
            {
                "q": "友達 (Tomodachi)",
                "en": [
                    "Friend.",
                    "Friends."
                ],
                "nl": [
                    "Vriend.",
                    "Vrienden."
                ]
            },
            {
                "q": "家族 (Kazoku)",
                "en": [
                    "Family."
                ],
                "nl": [
                    "Familie."
                ]
            },
            {
                "q": "愛しています (Aishiteimasu)",
                "en": [
                    "I love you."
                ],
                "nl": [
                    "Ik hou van je."
                ]
            }
        ]

        function getCurrentLanguage() {
            return new URLSearchParams(window.location.search).get('lang') || 'en';
        }

        function translate() {
            if (currentLanguage === 'en') {
                return;
            }

            document.title = getTranslation('title', "Learn Japanese");
            document.getElementById('title').textContent = getTranslation('title', "Learn Japanese");
            document.getElementById('subTitle').textContent = getTranslation('mostImportantWords', "100 most important Japanese phrases and words");
            document.getElementById('answer').placeholder = getTranslation('answer', "Type your answer");
            document.getElementById('submitAnswerButton').textContent = getTranslation('submitAnswerButton', "Submit");
            document.getElementById('searchCheatsheet').placeholder = getTranslation('search', "Search");
        }

        translate();

        function setLanguageSwitchState() {
            const dutchLink = document.getElementById('dutchLink');
            const englishLink = document.getElementById('englishLink');

            if (currentLanguage === 'en') {
                dutchLink.classList.remove('underline');
                englishLink.classList.add('underline');
            } else {
                dutchLink.classList.add('underline');
                englishLink.classList.remove('underline');
            }
        }

        setLanguageSwitchState();

        function setLearningModeSwitchState() {
            const fromJapaneseLink = document.getElementById('fromJapaneseLink');
            const toJapaneseLink = document.getElementById('toJapaneseLink');

            if (learningMode === 'fromJapanese') {
                fromJapaneseLink.classList.add('underline');
                toJapaneseLink.classList.remove('underline');
            } else {
                fromJapaneseLink.classList.remove('underline');
                toJapaneseLink.classList.add('underline');
            }
        }

        setLearningModeSwitchState();

        function updateLinksWithCurrentParams() {
            const dutchLink = document.getElementById('dutchLink');
            const englishLink = document.getElementById('englishLink');
            const fromJapaneseLink = document.getElementById('fromJapaneseLink');
            const toJapaneseLink = document.getElementById('toJapaneseLink');

            dutchLink.href = `?lang=nl&mode=${learningMode}`;
            englishLink.href = `?lang=en&mode=${learningMode}`;
            fromJapaneseLink.href = `?lang=${currentLanguage}&mode=fromJapanese`;
            toJapaneseLink.href = `?lang=${currentLanguage}&mode=toJapanese`;
        }

        updateLinksWithCurrentParams();

        function getTranslation(key, defaultValue) {
            if (currentLanguage === 'en') {
                return defaultValue ? defaultValue : key;
            }

            return translations[currentLanguage][key] || defaultValue;
        }

        function getMode() {
            return new URLSearchParams(window.location.search).get('mode') === 'toJapanese' ? 'toJapanese' : 'fromJapanese';
        }

        let currentSentence = {};
        let mistakes = {};
        let isFeedbackDisplayed = false;
        const submitAnswerButton = document.getElementById('submitAnswerButton');
        let currentTimeout = null;

        if (localStorage.getItem('mistakes')) {
            mistakes = JSON.parse(localStorage.getItem('mistakes'));
        }

        function getNextSentence() {
            let prioritizedSentences = sentences.filter(s => mistakes[s.q] && mistakes[s.q] > 1);

            if (prioritizedSentences.length) {
                return prioritizedSentences[Math.floor(Math.random() * prioritizedSentences.length)];
            }

            return sentences[Math.floor(Math.random() * sentences.length)];
        }

        function levenshtein(a, b) {
            const matrix = [];

            if (a.length == 0) return b.length;
            if (b.length == 0) return a.length;

            for (let i = 0; i <= b.length; i++) {
                matrix[i] = [i];
            }

            for (let j = 0; j <= a.length; j++) {
                matrix[0][j] = j;
            }

            for (let i = 1; i <= b.length; i++) {
                for (let j = 1; j <= a.length; j++) {
                    if (b.charAt(i - 1) == a.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(matrix[i - 1][j - 1] + 1, Math.min(matrix[i][j - 1] + 1, matrix[i - 1][j] + 1));
                    }
                }
            }

            return matrix[b.length][a.length];
        }

        function checkAnswer() {
            const questionBox = document.getElementById('questionBox');
            const userAnswer = document.getElementById('answer').value.trim();
            const feedback = document.getElementById('feedback');
            const correctAudio = document.getElementById('correctAudio');
            const incorrectAudio = document.getElementById('incorrectAudio');
            let isCorrect = false;

            if (!userAnswer) {
                return;
            }

            if (learningMode === 'fromJapanese') {
                isCorrect = currentSentence[currentLanguage].some(translation => levenshtein(userAnswer.toLowerCase(), translation.toLowerCase()) <= 2);
            } else {
                const romajiAnswer = currentSentence.q.match(/\((.*?)\)/)[1];
                isCorrect = levenshtein(userAnswer.toLowerCase(), romajiAnswer.toLowerCase()) <= 2;
            }

            const correctAnswers = learningMode === 'fromJapanese' ? currentSentence[currentLanguage].join(', ') : currentSentence.q;

            if (isCorrect) {
                const correctTranslation = getTranslation('correct', 'Correct!');
                feedback.textContent = `✅ ${correctTranslation} ${correctAnswers}`;
                if (mistakes[currentSentence.q]) {
                    mistakes[currentSentence.q]--;
                }
                isFeedbackDisplayed = true;
                submitAnswerButton.textContent = getTranslation('nextQuestion', "Next question");
                correctAudio.play();
                questionBox.classList.add('border-green-500');
            } else {
                const incorrectTranslation = getTranslation('incorrect', 'Incorrect! Correct answers: ');
                feedback.textContent = `❌ ${incorrectTranslation} ${correctAnswers}`;
                if (!mistakes[currentSentence.q]) {
                    mistakes[currentSentence.q] = 1;
                } else {
                    mistakes[currentSentence.q]++;
                }
                isFeedbackDisplayed = true;
                submitAnswerButton.textContent = getTranslation('nextQuestion', "Next question");
                incorrectAudio.play();
                questionBox.classList.add('border-red-500');
            }

            localStorage.setItem('mistakes', JSON.stringify(mistakes));

            currentTimeout ? clearTimeout(currentTimeout) : null;

            currentTimeout = setTimeout(loadNextSentence, 3500);
        }

        document.getElementById('answerForm').addEventListener('submit', e => {
            e.preventDefault();

            if (isFeedbackDisplayed) {
                loadNextSentence();
            } else {
                checkAnswer();
            }
        });

        function loadNextSentence() {
            currentTimeout ? clearTimeout(currentTimeout) : null;
            currentSentence = getNextSentence();
            document.getElementById('question').textContent = learningMode === 'fromJapanese' ? currentSentence.q : currentSentence[currentLanguage].join(' / ');
            document.getElementById('answer').value = '';
            document.getElementById('feedback').textContent = '';
            isFeedbackDisplayed = false;
            submitAnswerButton.textContent = getTranslation('submitAnswerButton', "Submit");
            questionBox.classList.remove('border-green-500', 'border-red-500');
        }

        loadNextSentence();

        function initializeCheatsheet() {
            const currentLanguage = getCurrentLanguage();

            const cheatsheet = document.getElementById('cheatsheet');

            sentences.forEach(sentence => {
                const li = document.createElement('li');
                li.classList.add('bg-slate-800', 'p-4', 'rounded-md', 'shadow-md', 'text-white', 'text-lg', 'font-medium', 'flex', 'items-center', 'justify-between');
                li.innerHTML = `
                    <div class="text-xl">${sentence.q}</div>
                    <div class="text-pink-400">${sentence[currentLanguage].join(' / ')}</div>
                `;
                cheatsheet.appendChild(li);
            });
        }

        initializeCheatsheet();

        document.getElementById('searchCheatsheet').addEventListener('input', e => {
            const searchTerm = e.target.value.trim().toLowerCase();
            const cheatsheet = document.getElementById('cheatsheet');

            cheatsheet.innerHTML = '';

            sentences.forEach(sentence => {
                if (sentence.q.toLowerCase().includes(searchTerm) || sentence[currentLanguage].join(' / ').toLowerCase().includes(searchTerm)) {
                    const li = document.createElement('li');
                    li.classList.add('bg-slate-800', 'p-4', 'rounded-md', 'shadow-md', 'text-white', 'text-lg', 'font-medium', 'flex', 'items-center', 'justify-between');
                    li.innerHTML = `
                        <div class="text-xl">${sentence.q}</div>
                        <div class="text-pink-400">${sentence[currentLanguage].join(' / ')}</div>
                    `;
                    cheatsheet.appendChild(li);
                }
            });
        });

    </script>
</body>

</html>