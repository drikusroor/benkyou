<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Prompt&display=swap" rel="stylesheet">
    <title>Learn Japanese</title>
    <style>
        body {
            font-family: 'Prompt', 'Arial', sans-serif;
            text-align: center;
        }
    </style>
</head>

<body>
    <div class="min-h-screen bg-black flex flex-col items-center justify-center p-5">
        <div class="bg-opacity-60 shadow-lg rounded-xl p-8 w-full max-w-xl border border-purple-600 bg-slate-900">
            <h1 class="text-4xl font-bold mb-4 text-pink-400">Learn Japanese</h1>
            <h2 class="text-2xl font-semibold mb-6 text-purple-500 tracking-wider">100 most important Japanese sentences
                and words</h2>

            <form id="answerForm" class="space-y-4">
                <div id="question" class="text-xl text-white font-medium"></div>

                <div>
                    <input type="text" id="answer" placeholder="Type your answer" required
                        class="w-full p-3 border border-purple-400 bg-opacity-50 bg-slate-800 text-white rounded-md focus:outline-none focus:border-pink-400 focus:ring focus:ring-purple-300 transition duration-150 ease-in-out">
                </div>

                <div>
                    <button type="submit" id="submitAnswerButton"
                        class="bg-purple-600 text-white px-6 py-3 rounded-md hover:bg-pink-600 focus:outline-none focus:border-pink-700 focus:ring focus:ring-purple-400 active:bg-pink-700 transition duration-150 ease-in-out">
                        Submit
                    </button>
                </div>

                <div id="feedback" class="text-lg text-pink-400 font-medium"></div>
            </form>
        </div>

        <div class="mt-8 bg-slate-900">

            <form class="flex items-center justify-center space-x-4 p-4">
                <input type="text" id="searchCheatsheet" placeholder="Search"
                    class="w-full p-3 border border-purple-400 bg-opacity-50 bg-slate-800 text-white rounded-md focus:outline-none focus:border-pink-400 focus:ring focus:ring-purple-300 transition duration-150 ease-in-out">
            </form>

            <ul class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 p-4" id="cheatsheet">
            </ul>
        </div>

    </div>

    <audio id="correctAudio" src="correct.m4a"></audio>
    <audio id="incorrectAudio" src="incorrect.m4a"></audio>

    <script>

        const sentences = [
            {
                "q": "こんにちは (Konnichiwa)",
                "en": [
                    "Hello."
                ]
            },
            {
                "q": "こんばんは (Konbanwa)",
                "en": [
                    "Good evening."
                ]
            },
            {
                "q": "さようなら (Sayonara)",
                "en": [
                    "Goodbye."
                ]
            },
            {
                "q": "ありがとうございます (Arigatou gozaimasu)",
                "en": [
                    "Thank you.",
                    "Thank you very much.",
                    "Thanks."
                ]
            },
            {
                "q": "はい (Hai)",
                "en": [
                    "Yes."
                ]
            },
            {
                "q": "いいえ (Iie)",
                "en": [
                    "No."
                ]
            },
            {
                "q": "すみません (Sumimasen)",
                "en": [
                    "Excuse me."
                ]
            },
            {
                "q": "おはようございます (Ohayou gozaimasu)",
                "en": [
                    "Good morning."
                ]
            },
            {
                "q": "おやすみなさい (Oyasuminasai)",
                "en": [
                    "Goodnight."
                ]
            },
            {
                "q": "お名前は何ですか (Onamae wa nan desu ka?)",
                "en": [
                    "What's your name?"
                ]
            },
            {
                "q": "わたしは [name] です (Watashi wa [name] desu)",
                "en": [
                    "I am [name]."
                ]
            },
            {
                "q": "どこから来ましたか (Doko kara kimashita ka?)",
                "en": [
                    "Where are you from?"
                ]
            },
            {
                "q": "わたしは [country] から来ました (Watashi wa [country] kara kimashita)",
                "en": [
                    "I'm from [country].",
                    "I came from [country]."
                ]
            },
            {
                "q": "日本語が分かりません (Nihongo ga wakarimasen)",
                "en": [
                    "I don't understand Japanese."
                ]
            },
            {
                "q": "英語を話せますか (Eigo o hanasemasu ka?)",
                "en": [
                    "Can you speak English?",
                    "Do you speak English?"
                ]
            },
            {
                "q": "トイレはどこですか (Toire wa doko desu ka?)",
                "en": [
                    "Where is the bathroom?",
                    "Where is the toilet?"
                ]
            },
            {
                "q": "水をください (Mizu o kudasai)",
                "en": [
                    "Please give me water.",
                    "Please give me some water.",
                    "Water, please."
                ]
            },
            {
                "q": "いくらですか (Ikura desu ka?)",
                "en": [
                    "How much is it?",
                    "How much does it cost?"
                ]
            },
            {
                "q": "高いです (Takai desu)",
                "en": [
                    "It's expensive."
                ]
            },
            {
                "q": "安いです (Yasui desu)",
                "en": [
                    "It's cheap."
                ]
            },
            {
                "q": "美味しい (Oishii)",
                "en": [
                    "Delicious.",
                    "Tasty."
                ]
            },
            {
                "q": "お腹がすいた (Onaka ga suita)",
                "en": [
                    "I'm hungry."
                ]
            },
            {
                "q": "のどが渇いた (Nodo ga kawaita)",
                "en": [
                    "I'm thirsty."
                ]
            },
            {
                "q": "駅はどこですか (Eki wa doko desu ka?)",
                "en": [
                    "Where is the station?"
                ]
            },
            {
                "q": "これをください (Kore o kudasai)",
                "en": [
                    "I'll take this."
                ]
            },
            {
                "q": "助けて (Tasukete)",
                "en": [
                    "Help!"
                ]
            },
            {
                "q": "病院はどこですか (Byouin wa doko desu ka?)",
                "en": [
                    "Where is the hospital?"
                ]
            },
            {
                "q": "痛い (Itai)",
                "en": [
                    "It hurts."
                ]
            },
            {
                "q": "どれ (Dore?)",
                "en": [
                    "Which one?", "Which?"
                ]
            },
            {
                "q": "今何時ですか (Ima nanji desu ka?)",
                "en": [
                    "What time is it now?",
                    "What's the time?"
                ]
            },
            {
                "q": "日本は初めてです (Nihon wa hajimete desu)",
                "en": [
                    "It's my first time in Japan."
                ]
            },
            {
                "q": "また会いましょう (Mata aimashou)",
                "en": [
                    "Let's meet again."
                ]
            },
            {
                "q": "分かりました (Wakarimashita)",
                "en": [
                    "I understand."
                ]
            },
            {
                "q": "もう一度言ってください (Mou ichido itte kudasai)",
                "en": [
                    "Please say it one more time."
                ]
            },
            {
                "q": "インターネットがつながりません (Inta-netto ga tsunagari masen)",
                "en": [
                    "The internet isn't working."
                ]
            },
            {
                "q": "メニューを見せてください (Menyu o misete kudasai)",
                "en": [
                    "Please show me the menu.",
                    "The menu, please."
                ]
            },
            {
                "q": "チェックをください (Chekku o kudasai)",
                "en": [
                    "Check, please.",
                ]
            },
            {
                "q": "電話番号は何ですか (Denwa bangou wa nan desu ka?)",
                "en": [
                    "What's your phone number?"
                ]
            },
            {
                "q": "予約したい (Yoyaku shitai)",
                "en": [
                    "I'd like to make a reservation."
                ]
            },
            {
                "q": "無料ですか (Muryou desu ka?)",
                "en": [
                    "Is it free?"
                ]
            },
            {
                "q": "ホテルはどこですか (Hoteru wa doko desu ka?)",
                "en": [
                    "Where is the hotel?"
                ]
            },
            {
                "q": "Wi-Fiのパスワードは何ですか (Wi-Fi no pasuwādo wa nan desu ka?)",
                "en": [
                    "What's the Wi-Fi password?"
                ]
            },
            {
                "q": "すぐに (Sugu ni)",
                "en": [
                    "Right away."
                ]
            },
            {
                "q": "ゆっくり (Yukkuri)",
                "en": [
                    "Slowly."
                ]
            },
            {
                "q": "大丈夫 (Daijoubu)",
                "en": [
                    "It's okay."
                ]
            },
            {
                "q": "違います (Chigaimasu)",
                "en": [
                    "It's wrong."
                ]
            },
            {
                "q": "わたしの (Watashi no)",
                "en": [
                    "Mine.",
                    "My."
                ]
            },
            {
                "q": "いつ (Itsu?)",
                "en": [
                    "When?"
                ]
            },
            {
                "q": "どうして (Doushite?)",
                "en": [
                    "Why?"
                ]
            },
            {
                "q": "どこ (Doko?)",
                "en": [
                    "Where?"
                ]
            },
            {
                "q": "誰 (Dare?)",
                "en": [
                    "Who?"
                ]
            },
            {
                "q": "どう (Dou?)",
                "en": [
                    "How?"
                ]
            },
            {
                "q": "何 (Nani?)",
                "en": [
                    "What?"
                ]
            },
            {
                "q": "好きです (Suki desu)",
                "en": [
                    "I like it."
                ]
            },
            {
                "q": "嫌いです (Kirai desu)",
                "en": [
                    "I don't like it."
                ]
            },
            {
                "q": "もっと (Motto)",
                "en": [
                    "More."
                ]
            },
            {
                "q": "それで (Sore de)",
                "en": [
                    "And then?"
                ]
            },
            {
                "q": "こちら (Kochira)",
                "en": [
                    "This way."
                ]
            },
            {
                "q": "あそこ (Asoko)",
                "en": [
                    "Over there."
                ]
            },
            {
                "q": "今日 (Kyou)",
                "en": [
                    "Today."
                ]
            },
            {
                "q": "明日 (Ashita)",
                "en": [
                    "Tomorrow."
                ]
            },
            {
                "q": "昨日 (Kinou)",
                "en": [
                    "Yesterday."
                ]
            },
            {
                "q": "いつも (Itsumo)",
                "en": [
                    "Always."
                ]
            },
            {
                "q": "たまに (Tama ni)",
                "en": [
                    "Sometimes."
                ]
            },
            {
                "q": "もう (Mou)",
                "en": [
                    "Already."
                ]
            },
            {
                "q": "まだ (Mada)",
                "en": [
                    "Not yet."
                ]
            },
            {
                "q": "ここ (Koko)",
                "en": [
                    "Here."
                ]
            },
            {
                "q": "どうぞ (Douzo)",
                "en": [
                    "Please (when offering something)."
                ]
            },
            {
                "q": "よろしくお願いします (Yoroshiku onegaishimasu)",
                "en": [
                    "Nice to meet you",
                    "Please take care of it."
                ]
            },
            {
                "q": "遅い (Osoi)",
                "en": [
                    "Late."
                ]
            },
            {
                "q": "早い (Hayai)",
                "en": [
                    "Early.",
                    "Fast."
                ]
            },
            {
                "q": "いい (Ii)",
                "en": [
                    "Good.",
                    "Fine.",
                    "Okay.",
                    "Nice."
                ]
            },
            {
                "q": "悪い (Warui)",
                "en": [
                    "Bad."
                ]
            },
            {
                "q": "大きい (Ookii)",
                "en": [
                    "Big."
                ]
            },
            {
                "q": "小さい (Chiisai)",
                "en": [
                    "Small."
                ]
            },
            {
                "q": "長い (Nagai)",
                "en": [
                    "Long."
                ]
            },
            {
                "q": "短い (Mijikai)",
                "en": [
                    "Short."
                ]
            },
            {
                "q": "寒い (Samui)",
                "en": [
                    "Cold."
                ]
            },
            {
                "q": "暑い (Atsui)",
                "en": [
                    "Hot."
                ]
            },
            {
                "q": "眠い (Nemui)",
                "en": [
                    "Sleepy."
                ]
            },
            {
                "q": "うるさい (Urusai)",
                "en": [
                    "Noisy."
                ]
            },
            {
                "q": "静か (Shizuka)",
                "en": [
                    "Quiet."
                ]
            },
            {
                "q": "甘い (Amai)",
                "en": [
                    "Sweet."
                ]
            },
            {
                "q": "辛い (Karai)",
                "en": [
                    "Spicy."
                ]
            },
            {
                "q": "楽しい (Tanoshii)",
                "en": [
                    "Fun."
                ]
            },
            {
                "q": "つまらない (Tsumaranai)",
                "en": [
                    "Boring."
                ]
            },
            {
                "q": "新しい (Atarashii)",
                "en": [
                    "New."
                ]
            },
            {
                "q": "古い (Furui)",
                "en": [
                    "Old."
                ]
            },
            {
                "q": "近い (Chikai)",
                "en": [
                    "Near.", "Close."
                ]
            },
            {
                "q": "遠い (Tooi)",
                "en": [
                    "Far."
                ]
            },
            {
                "q": "綺麗 (Kirei)",
                "en": [
                    "Beautiful."
                ]
            },
            {
                "q": "汚い (Kitanai)",
                "en": [
                    "Dirty."
                ]
            },
            {
                "q": "明るい (Akarui)",
                "en": [
                    "Bright."
                ]
            },
            {
                "q": "暗い (Kurai)",
                "en": [
                    "Dark."
                ]
            },
            {
                "q": "高い (Takai)",
                "en": [
                    "Tall.",
                    "High.",
                ]
            },
            {
                "q": "低い (Hikui)",
                "en": [
                    "Short (in height)."
                ]
            },
            {
                "q": "若い (Wakai)",
                "en": [
                    "Young."
                ]
            },
            {
                "q": "友達 (Tomodachi)",
                "en": [
                    "Friend."
                ]
            },
            {
                "q": "家族 (Kazoku)",
                "en": [
                    "Family."
                ]
            },
            {
                "q": "愛しています (Aishiteimasu)",
                "en": [
                    "I love you."
                ]
            }
        ]


        let currentSentence = {};
        let mistakes = {};
        let isFeedbackDisplayed = false;
        const submitAnswerButton = document.getElementById('submitAnswerButton');
        let currentTimeout = null;

        if (localStorage.getItem('mistakes')) {
            mistakes = JSON.parse(localStorage.getItem('mistakes'));
        }

        function getNextSentence() {
            let prioritizedSentences = sentences.filter(s => mistakes[s.q] && mistakes[s.q] > 1);

            if (prioritizedSentences.length) {
                return prioritizedSentences[Math.floor(Math.random() * prioritizedSentences.length)];
            }

            return sentences[Math.floor(Math.random() * sentences.length)];
        }

        function levenshtein(a, b) {
            const matrix = [];

            if (a.length == 0) return b.length;
            if (b.length == 0) return a.length;

            for (let i = 0; i <= b.length; i++) {
                matrix[i] = [i];
            }

            for (let j = 0; j <= a.length; j++) {
                matrix[0][j] = j;
            }

            for (let i = 1; i <= b.length; i++) {
                for (let j = 1; j <= a.length; j++) {
                    if (b.charAt(i - 1) == a.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(matrix[i - 1][j - 1] + 1, Math.min(matrix[i][j - 1] + 1, matrix[i - 1][j] + 1));
                    }
                }
            }

            return matrix[b.length][a.length];
        }

        function checkAnswer() {
            const userAnswer = document.getElementById('answer').value.trim();
            const feedback = document.getElementById('feedback');
            const correctAudio = document.getElementById('correctAudio');
            const incorrectAudio = document.getElementById('incorrectAudio');

            if (!userAnswer) {
                return;
            }

            // Check against each possible English translation
            let isCorrect = currentSentence.en.some(translation => levenshtein(userAnswer, translation) <= 2);

            if (isCorrect) {
                feedback.textContent = `✅ Correct! (${currentSentence.en.join(', ')})`;
                if (mistakes[currentSentence.q]) {
                    mistakes[currentSentence.q]--;
                }
                isFeedbackDisplayed = true;
                submitAnswerButton.textContent = "Next question";
                correctAudio.play();
            } else {
                feedback.textContent = "❌ Incorrect! Correct answers: " + currentSentence.en.join(', ');
                if (!mistakes[currentSentence.q]) {
                    mistakes[currentSentence.q] = 1;
                } else {
                    mistakes[currentSentence.q]++;
                }
                isFeedbackDisplayed = true;
                submitAnswerButton.textContent = "Next question";
                incorrectAudio.play();
            }

            localStorage.setItem('mistakes', JSON.stringify(mistakes));

            currentTimeout ? clearTimeout(currentTimeout) : null;

            currentTimeout = setTimeout(loadNextSentence, 3500);
        }

        document.getElementById('answerForm').addEventListener('submit', e => {
            e.preventDefault();

            if (isFeedbackDisplayed) {
                loadNextSentence();
            } else {
                checkAnswer();
            }
        });

        function loadNextSentence() {
            currentTimeout ? clearTimeout(currentTimeout) : null;
            currentSentence = getNextSentence();
            document.getElementById('question').textContent = currentSentence.q;
            document.getElementById('answer').value = '';
            document.getElementById('feedback').textContent = '';
            isFeedbackDisplayed = false;
            submitAnswerButton.textContent = "Submit";
        }

        loadNextSentence();

        function initializeCheatsheet() {
            const cheatsheet = document.getElementById('cheatsheet');

            sentences.forEach(sentence => {
                const li = document.createElement('li');
                li.classList.add('bg-slate-800', 'p-4', 'rounded-md', 'shadow-md', 'text-white', 'text-lg', 'font-medium', 'flex', 'items-center', 'justify-between');
                li.innerHTML = `
                    <div class="text-xl">${sentence.q}</div>
                    <div class="text-pink-400">${sentence.en.join(' / ')}</div>
                `;
                cheatsheet.appendChild(li);
            });
        }

        initializeCheatsheet();

        document.getElementById('searchCheatsheet').addEventListener('input', e => {
            const searchTerm = e.target.value.trim().toLowerCase();
            const cheatsheet = document.getElementById('cheatsheet');

            cheatsheet.innerHTML = '';

            sentences.forEach(sentence => {
                if (sentence.q.toLowerCase().includes(searchTerm) || sentence.en.join(' / ').toLowerCase().includes(searchTerm)) {
                    const li = document.createElement('li');
                    li.classList.add('bg-slate-800', 'p-4', 'rounded-md', 'shadow-md', 'text-white', 'text-lg', 'font-medium', 'flex', 'items-center', 'justify-between');
                    li.innerHTML = `
                        <div class="text-xl">${sentence.q}</div>
                        <div class="text-pink-400">${sentence.en.join(' / ')}</div>
                    `;
                    cheatsheet.appendChild(li);
                }
            });
        });

    </script>
</body>

</html>